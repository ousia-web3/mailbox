# 뉴스 수집 기준 및 날짜 검증 로직 개선 보고서

**작성일**: 2026년 1월 9일
**작성자**: Antigravity (AI Assistant)
**관련 파일**: `newsletter_system.py`, `news_collector_working.py`

---

## 1. 개요 (Overview)

뉴스레터 생성 시 추출 대상 날짜가 맞지 않거나, 오래된 뉴스가 포함되는 문제를 해결하기 위해 뉴스 수집 및 검증 로직을 전면적으로 수정하였습니다. 기존의 관대한(Permissive) 기준을 **엄격한(Strict) 기준**으로 변경하여, **"전날(D-1)"** 날짜와 정확히 일치하는 뉴스만 수집되도록 강제했습니다.

## 2. 주요 변경 사항 (Changes)

### 2.1 수집 요청 기준 변경 (`newsletter_system.py`)

시스템이 뉴스 수집기에 요청하는 날짜 기준을 변경했습니다.

| 구분     | 변경 전 (Before)                                    | 변경 후 (After)                                          |
| :------- | :-------------------------------------------------- | :------------------------------------------------------- |
| **코드** | `today_date = self.news_collector.get_today_date()` | `target_date = self.news_collector.get_yesterday_date()` |
| **설명** | **"오늘(당일)"** 뉴스를 수집하도록 설정되어 있었음  | **"어제(전날)"** 뉴스를 수집하도록 명확히 변경           |

### 2.2 날짜 파싱 로직 개선 (`news_collector_working.py`)

날짜 형식을 인식하지 못했을 때의 처리 방식을 변경했습니다.

| 구분     | 변경 전 (Before)                                | 변경 후 (After)                                       |
| :------- | :---------------------------------------------- | :---------------------------------------------------- |
| **함수** | `parse_pub_date`                                | `parse_pub_date`                                      |
| **동작** | 파싱 실패 시 **"오늘 날짜"**를 기본값으로 반환  | 파싱 실패 시 **`None`**을 반환하여 수집 대상에서 제외 |
| **효과** | 날짜 불명 뉴스가 최신 뉴스로 오인되는 문제 방지 | 날짜가 확실하지 않은 데이터는 원천 차단               |

### 2.3 날짜 유효성 검증 강화 (`news_collector_working.py`)

수집된 뉴스의 날짜를 심사하는 기준을 대폭 강화했습니다.

| 구분          | 변경 전 (Before)                                                             | 변경 후 (After)                                                                              |
| :------------ | :--------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------- |
| **함수**      | `validate_news_date`                                                         | `validate_news_date`                                                                         |
| **검증 기준** | 날짜 정보 없음/에러 시 **"통과(True)"**<br>미래/과거 날짜만 아니면 대략 허용 | 날짜 정보 없음/에러 시 **"탈락(False)"**<br>목표 날짜(어제)와 **정확히 일치(==)**해야만 통과 |

### 2.4 최종 필터링 로직 교체 (`news_collector_working.py`)

수집 마지막 단계의 필터링 함수를 교체했습니다.

| 구분       | 변경 전 (Before)                        | 변경 후 (After)                                              |
| :--------- | :-------------------------------------- | :----------------------------------------------------------- |
| **함수명** | `filter_today_news`                     | `filter_invalid_dates`                                       |
| **동작**   | 사실상 모든 뉴스를 통과시킴 (로깅 위주) | 수집된 리스트를 전수 조사하여 **목표 날짜와 다른 뉴스 삭제** |

## 3. 기대 효과 (Impact)

1.  **데이터 정확성 확보**: "어제" 날짜가 찍힌 뉴스만 100% 수집되므로, 수동 검수 시 날짜 오류가 발생하지 않습니다.
2.  **노이즈 제거**: 날짜를 알 수 없는 광고성 기사나, 메타데이터가 손상된 기사가 자동으로 걸러집니다.
3.  **운영 안정성**: 시스템이 의도한 날짜(D-1)의 데이터만 처리하므로, 뉴스레터의 시의성이 보장됩니다.

---

## 4. 참고 코드 (Code Snippets)

### 변경된 검증 로직 예시

```python
def validate_news_date(self, extracted_date, search_date=None, url=None):
    # ... (중략) ...

    # 목표 날짜와 정확히 일치하는지 검증
    if extracted_date == target_date_str:
        return True, f"날짜 일치: {extracted_date}"
    else:
        return False, f"날짜 불일치: 추출={extracted_date}, 목표={target_date_str}"
```
