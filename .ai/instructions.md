# AI 작업 헌법 (AI Work Constitution)

이 문서는 이 프로젝트에서 AI(Cursor, Windsurf 등)가 작업을 수행할 때 반드시 준수해야 할 절대적인 규칙을 정의합니다.

## 0. 프로젝트 초기화 규칙 (Project Bootstrap)

- 이 프로젝트는 초기 실행 시 자동으로 필수 폴더 및 규칙 파일을 생성할 수 있습니다.
- 초기화 단계에서 생성되는 파일은 표준 템플릿을 따릅니다.
- 초기화 스크립트는 기존 파일이 있을 경우 덮어쓰지 않고, 누락된 항목만 보완합니다.

## 1. 실행 정책 (Execution Policy)

- **기본 원칙**: 모든 명령어 실행은 `rules/EXEC_POLICY.md`를 따릅니다.
- **안전한 실행**: 시스템에 파괴적인 영향을 줄 수 있는 명령어는 실행 전 반드시 사용자의 확인을 받아야 합니다.
- **테스트 및 검증**: 코드의 정확성을 검증하기 위한 테스트 실행은 권장되나, 실행 전 사용자에게 알리는 것을 원칙으로 합니다.
- **테스트 파일 관리**: 모든 테스트 관련 파일(단위 테스트, 통합 테스트, 재현 스크립트 등)은 반드시 `tests/` 폴더 내에 생성하거나 이동시켜야 합니다. 프로젝트 루트 디렉토리를 어지럽히지 마십시오.

## 2. 코드 수정 원칙 (Code Modification Principles)

- **최소 diff 원칙**: 수정이 필요한 부분만 정확히 타겟팅하여 변경해야 합니다. 파일 전체를 불필요하게 덮어쓰거나 포맷팅을 변경하여 diff를 어지럽히지 마십시오.
- **관련 없는 파일 수정 금지**: 요청된 작업과 직접적인 관련이 없는 파일은 절대 건드리지 마십시오.
- **정적 추론 및 검증**: 코드 실행 전 정적 분석을 통해 논리적 오류를 최대한 사전에 검증하십시오.
- **자동 생성 파일 보호**: 자동 생성된 규칙/로그 파일은 프로젝트 기준 문서이므로, 사용자의 명시적인 요청 없이 내용 변경을 허용하지 않습니다.
- **AI vs 코드 역할 분담**: 창의적 생성, 요약, 추론은 AI가 담당하되, **데이터 정합성(개수 일치, 포맷팅 등)**이 중요한 로직은 반드시 **코드(Python 등)**로 구현하여 처리해야 합니다. AI의 생성 능력에 의존하여 정형 데이터를 처리하지 마십시오.

## 3. 오류 관리 및 이력 (Error Management & History)

- **이력 문서 갱신 필수**: 오류가 발생하거나 오류를 수정했을 경우, 반드시 `logs/ERROR_HISTORY.md`와 `rules/CHANGELOG.md`를 갱신해야 합니다.
- **선행 참조**: 코드 수정을 시작하기 전에 `logs/ERROR_HISTORY.md`와 `rules/CHANGELOG.md`를 먼저 읽고, 과거의 실수나 패턴을 파악하여 동일한 오류를 반복하지 않도록 주의하십시오.
- **컨텍스트 최적화**: `rules/CHANGELOG.md` 참조 시 토큰 절약을 위해 전체를 읽지 말고 **최근 5개 항목**을 우선적으로 참조하십시오.
- **예방 조치 기록**: 명시적 오류가 발생하지 않았더라도, 재현 가능성이 높거나 과거 오류와 유사한 위험 요소를 제거한 경우 `rules/CHANGELOG.md`에 예방 조치로 기록합니다.

## 4. 문서화 및 완료 조건 (Documentation & Definition of Done)

### 4.1. 문서화 의무 (Mandatory Documentation)

- **모든 코드 변경은 문서 변경을 동반해야 합니다.** 코드만 수정하고 문서를 수정하지 않는 것은 "미완성" 작업입니다.
- **필수 갱신 문서**:
  - `rules/CHANGELOG.md`: 변경 내용, 이유, 재발 방지 대책 기록
  - `logs/ERROR_HISTORY.md`: 오류 수정 시 발생 원인과 해결책 기록
- **타이밍**: 코드를 수정하기 **직전** 또는 수정과 **동시에** 문서 업데이트 계획을 세우십시오.

### 4.2. 완료 조건 (Definition of Done)

AI는 다음 질문에 모두 "예"라고 답할 수 있을 때만 작업을 완료했다고 간주해야 합니다.

1. 사용자의 요구사항을 충족하는 코드를 작성했는가?
2. 코드가 의도한 대로 동작함을 검증했는가?
3. **`rules/CHANGELOG.md`에 변경 내역을 기록했는가?**
4. **오류 수정의 경우 `logs/ERROR_HISTORY.md`를 업데이트했는가?**
5. 불필요하게 생성된 임시 파일은 정리했는가?
